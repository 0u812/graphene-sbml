<div class="row" ng-controller="SbmlLayoutCtrl">
  <div class="col-xs-1">
    <h4>Click Mode</h4>
    <div class="btn-group-vertical">
      <button class="btn btn-default btn-sm" ng-model="AppState.clickMode" btn-radio="'selected'" tooltip="Select Node" tooltip-popup-delay="1000" tooltip-placement="right">
        <i class="fa fa-location-arrow fa-flip-horizontal"></i>
      </button>
      <button class="btn btn-default btn-sm" ng-model="AppState.clickMode" btn-radio="'fixed'" tooltip="Lock Node" tooltip-popup-delay="1000" tooltip-placement="right">
        <i class="fa fa-lock"></i>
      </button>
    </div>
  </div>
  <div class="col-xs-10 well">
    <svg
      zoomable="AppState.zoom"
      xmlns="http://www.w3.org/2000/svg"
      ng-attr-height="{{imports.height || '800px'}}"
      ng-attr-width="{{imports.width || '100%'}}"
      >
      <style>
      svg .node.species {
        stroke: #FFB800;
        stroke-width: 3px;
        size: 300px;
      }
      svg .link {
        stroke: black;
        stroke-width: 3px;
      }
      svg .link.modifier {
        stroke-dasharray: 5, 5;
      }
      svg .node-label {
        font-size: 14px;
        font-family: Georgia;
        font-weight: bolder;
        text-anchor: middle;
        dominant-baseline: middle;
      }
      svg .node.selected {
        stroke: #FF0000;
      }
    
      svg .node.fixed{
        stroke: black;
        stroke-width: 5px;
      }
      /*
      svg .link.selected {
        stroke: #FF0000;
      }*/
      svg marker {
        overflow: visible;
      }
      svg .null-symbol {
        fill: none;
        stroke: black;
        stroke-width: 3px;
      }
      </style>
      <defs>
        <marker 
          case-sensitive="refX,refY" 
          id="production" 
          viewBox="0 0 10 10" 
          ng-attr-refX="{{-2}}"
          ng-attr-refY="{{0}}" 
          markerWidth="10" 
          markerHeight="10" 
          orient="auto">
          <path 
            fill="url(#markerGradient)" 
            stroke="#0013FF" 
            transform="rotate(-90)" 
            ng-attr-d="{{sgGeo.arrow({size: 10, type: 'triangle-down'})}}">
          </path>
        </marker>
        <marker 
          case-sensitive="refX,refY" 
          id="degradation" 
          viewBox="0 0 10 10" 
          ng-attr-refX="{{-2}}"
          ng-attr-refY="{{0}}" 
          markerWidth="10" 
          markerHeight="10" 
          orient="auto">
          <path 
            fill="url(#markerGradient)" 
            stroke="#0013FF" 
            transform="rotate(-90)" 
            ng-attr-d="{{sgGeo.arrow({size: 10, type: 'triangle-down'})}}"></path>
        </marker>
        <marker 
          case-sensitive="refX,refY" 
          id="modifier" 
          viewBox="0 0 10 10" 
          markerWidth="30"
          markerHeight="30" 
          ng-attr-refX="{{-0.4}}" 
          ng-attr-refY="{{0}}" 
          orient="auto">
          <path 
            stroke="black" 
            stroke-width="0.3" 
            fill="none" 
            ng-attr-d="{{sgGeo.arrow({size: 1, type: 'circle'})}}">
          </path>
        </marker>
        <linearGradient id="gradient">
          <stop offset="5%" stop-color="#FFDC9E"></stop>
          <stop offset="95%" stop-color="#FFF"></stop>
        </linearGradient>
        <linearGradient id="markerGradient">
          <stop offset="5%" stop-color="rgb(97, 116, 255)"></stop>
          <stop offset="95%" stop-color="#FFF"></stop>
        </linearGradient>
        <linearGradient id="reactionGradient">
          <stop offset="5%" stop-color="#B0C0FF"></stop>
          <stop offset="95%" stop-color="#FFF"></stop>
        </linearGradient>
      </defs>
      <g ng-attr-transform="translate({{translate.x || 0}}, {{translate.y || 0}})scale({{scale || 1}})">
        <g 
          class="link"
          ng-repeat="link in model.links.product"
          ng-switch on="imports.showArcs"
          >
          <path
            ng-click="toggleProperty(link.reaction)"
            ng-attr-d="
              M {{link.x1}} {{link.y1}}
              C
              {{link.reaction.getCp(2).x}} {{link.reaction.getCp(2).y}}
              {{link.cp2.x}} {{link.cp2.y}}
              {{link.x2}} {{link.y2}}
            "
            marker-end="url(#production)"
            ng-attr-opacity="{{link.opacity}}"
            ng-attr-stroke="{{link.reaction.selected ? 'red' : 'black'}}"
            ng-attr-stroke-width="{{'3px'}}"
            fill="none"
          />
          <g
            ng-if="link.reaction.selected"
          >
            <line
              stroke="red"
              stroke-dasharray="1, 1"
              ng-attr-x1="{{link.x2}}"
              ng-attr-y1="{{link.y2}}"
              ng-attr-x2="{{link.cp2.x}}"
              ng-attr-y2="{{link.cp2.y}}"
            />
            <circle
              stroke="red"
              ng-attr-cx="{{link.cp2.x}}"
              ng-attr-cy="{{link.cp2.y}}"
              ng-attr-r="{{7}}"
              fill="none"
            />
          </g>
          <line
            ng-if="false"
            class="reaction production link"
            ng-attr-opacity="{{link.opacity}}"
            marker-end="url(#production)"
            ng-attr-x1="{{link.x1}}"
            ng-attr-y1="{{link.y1}}"
            ng-attr-x2="{{link.x2}}"
            ng-attr-y2="{{link.y2}}">
          </line>
        </g>
        <g 
          class="link"
          ng-repeat="link in model.links.reactant" 
          ng-switch on="imports.showArcs"
        >
          <path
            ng-click="toggleProperty(link.reaction)"
            ng-attr-d="
              M {{link.x1}} {{link.y1}}
              C 
              {{link.cp1.x}} {{link.cp1.y}}
              {{link.reaction.getCp(1).x}} {{link.reaction.getCp(1).y}}
              {{link.x2}} {{link.y2}}
            "
            fill="none"
            ng-attr-stroke="{{link.reaction.selected ? 'red' : 'black'}}"
            ng-attr-stroke-width="{{'3px'}}"
            ng-attr-opacity="{{link.opacity}}"
          />
          <g
            ng-if="link.reaction.selected"
          >
            <line
              stroke="red"
              stroke-dasharray="1, 1"
              ng-attr-x1="{{link.x1}}"
              ng-attr-y1="{{link.y1}}"
              ng-attr-x2="{{link.cp1.x}}"
              ng-attr-y2="{{link.cp1.y}}"
            />
            <circle
              stroke="red"
              ng-attr-cx="{{link.cp1.x}}"
              ng-attr-cy="{{link.cp1.y}}"
              ng-attr-r="{{7}}"
              fill="none"
              
            />
          </g>
          <line 
            ng-switch-default
            ng-if="false"
            ng-class="{selected: isSelected}"
            class="reaction reactant link"
            ng-attr-opacity="{{link.opacity}}"
            ng-attr-x1="{{link.x1}}"
            ng-attr-y1="{{link.y1}}"
            ng-attr-x2="{{link.x2}}"
            ng-attr-y2="{{link.y2}}">
          </line>
        </g>
        <g ng-repeat="link in lines.modifier" ng-switch on="imports.showArcs">
          <path 
            ng-switch-when="true"
            class="modifier link" 
            ng-attr-opacity="{{link.opacity}}"
            ng-attr-d={{sgGeo.linkArc(link)}}
            fill="none"
            ></path>
          <line 
            ng-switch-default
            ng-class="{selected: isSelected}" 
            class="modifier link" 
            ng-attr-opacity="{{link.opacity}}"
            ng-attr-x1="{{link.x1}}"
            ng-attr-y1="{{link.y1}}" 
            ng-attr-x2="{{link.x2}}" 
            ng-attr-y2="{{link.y2}}"
            marker-end="url(#modifier)">
          </line>
        </g>
        <g
          ng-repeat="link in lines.source" 
          ng-switch on="imports.showArcs"
          >
          <path 
            ng-switch-when="true"
            class="source link"
            ng-attr-opacity="{{link.opacity}}"
            ng-attr-d={{linkArc(link)}}
            fill="none"
            ></path>
          <line
            ng-switch-default
            class="source link"
            ng-attr-x1="{{link.x1}}"
            ng-attr-y1="{{link.y1}}" 
            ng-attr-x2="{{link.x2}}" 
            ng-attr-y2="{{link.y2}}"></line>
        </g>
        <g
          ng-repeat="link in lines.sink"
          ng-switch on="imports.showArcs"
          >
          <path 
            ng-switch-when="true"
            class="sink link"
            ng-attr-opacity="{{link.opacity}}"
            ng-attr-d={{linkArc(link)}}
            fill="none"
            ></path>
          <line
            ng-switch-default
            class="sink link"
            ng-attr-opacity="{{link.opacity}}"
            ng-attr-x1="{{link.x1}}"
            ng-attr-y1="{{link.y1}}" 
            ng-attr-x2="{{link.x2}}" 
            ng-attr-y2="{{link.y2}}"
            marker-end="url(#production)"></line>
        </g>
        <g 
          sg-drag
          sg-drag-begin="node"
          sg-drag-move="node.updatePosition.bind(node)"
          ng-repeat="node in model.nodes.species"
          ng-click="toggleProperty(node)"
          ng-attr-opacity="{{node.opacity}}"
          ng-attr-transform="translate({{node.x}},{{node.y}})"
          style="cursor: pointer;"
          >
          <rect 
            ng-class="{fixed: node.fixed, selected: node.selected}"
            class="species node"
            ng-attr-x="{{-node.width/2}}"
            ng-attr-y="{{-node.height/2}}"
            ng-attr-width="{{node.width}}" 
            ng-attr-height="{{node.height}}"
            ng-attr-ry="{{node.height/2}}"
            fill="url(#gradient)"
            >
          </rect>
          <text class="node-label">{{node.id | truncateTo:8}}</text>
          <title>ID: {{node.id}}, Name: {{node.name}}</title>
        </g>
        <g 
          draggable 
          ng-repeat="node in model.nodes.reactions" 
        >
          <circle 
            ng-class="node.classes" 
            class="node" 
            ng-attr-r="{{4}}"
            fill="black" 
            stroke="black"
            ng-attr-opacity="{{imports.showReactionNodes ? 1 : 0}}"
            ng-attr-transform="translate({{node.x}},{{node.y}})"
            >
            <title>ID: {{node.id}}, Name: {{node.name}}</title>
          </circle>
          <g
            ng-if="node.selected"
          >
            <g
              ng-if="node.fixed"
              ng-attr-transform="translate({{node.x}},{{node.y}}) scale(0.005)"
              >
              <path d="M448 1568v-576q0-40 28-68t68-28h32v-192q0-184 132-316t316-132 316 132 132 316v192h32q40 0 68 28t28 68v576q0 40-28 68t-68 28h-960q-40 0-68-28t-28-68zm320-672h512v-192q0-106-75-181t-181-75-181 75-75 181v192z"/>
            </g>
            <line
              stroke="red"
              stroke-dasharray="1, 1"
              ng-attr-x1="{{node.getCp(1).x}}"
              ng-attr-y1="{{node.getCp(1).y}}"
              ng-attr-x2="{{node.getCp(2).x}}"
              ng-attr-y2="{{node.getCp(2).y}}"
            />
            <circle
              sg-drag
              sg-drag-begin="node.getCp(1)"
              sg-drag-move="node.updateCp1.bind(node)"
              stroke="red"
              ng-attr-cx="{{node.getCp(1).x}}"
              ng-attr-cy="{{node.getCp(1).y}}"
              ng-attr-r="{{7}}"
              fill="white"
            />
            <circle
              sg-drag
              sg-drag-begin="node.getCp(2)"
              sg-drag-move="node.updateCp2.bind(node)"
              stroke="red"
              ng-attr-cx="{{node.getCp(2).x}}"
              ng-attr-cy="{{node.getCp(2).y}}"
              ng-attr-r="{{7}}"
              fill="white"
            />
          </g>
          <text class="node-label">{{}}</text>
        </g>
        <g 
          draggable 
          ng-repeat="node in sourceNodes" 
          ng-attr-transform="translate({{node.x}},{{node.y}})">
          <g class="null-symbol">
            <circle 
              class = "node"
              ng-class="{fixed: node.fixed, selected: node.selected}" 
              ng-attr-r="{{node.height / 2}}"
              fill="white">
            </circle>
            <line 
              class = "node"
              ng-class="{fixed: node.fixed, selected: node.selected}" 
              ng-attr-x1="{{-10}}" 
              ng-attr-y1="{{10}}"
              ng-attr-x2="{{10}}" 
              ng-attr-y2="{{-10}}">
            </line>
          </g>
        </g>
        <g 
          draggable 
          ng-repeat="node in sinkNodes" 
          ng-attr-transform="translate({{node.x}},{{node.y}})">
          <g class="null-symbol">
            <circle 
              ng-attr-r="{{node.height / 2}}"
              class = "node"
              ng-class="{fixed: node.fixed, selected: node.selected}" 
              fill="white"
              >
            </circle>
            <line 
              class = "node"
              ng-class="{fixed: node.fixed, selected: node.selected}" 
              ng-attr-x1="{{-10}}" 
              ng-attr-y1="{{10}}"
              ng-attr-x2="{{10}}" 
              ng-attr-y2="{{-10}}">
            </line>
          </g>
        </g>
      </g>
    </svg>
  </div>
  <div class="col-xs-1">
    <h4>Auto Layout</h4>
    <div class="btn-group-vertical">
      <button class="btn btn-default btn-sm" ng-click="layout.force.stop()"
        tooltip="Stop Auto-Layout"
        tooltip-placement="left"
        tooltip-append-to-body="true"
        tooltip-popup-delay="1000"
        >
        <i class="fa fa-stop"></i>
      </button>
      <button class="btn btn-default btn-sm" ng-click="layout.start()"
        tooltip="Start Auto-Layout"
        tooltip-placement="left"
        tooltip-append-to-body="true"
        tooltip-popup-delay="1000"
        >
        <i class="fa fa-play"></i>
      </button>
      <button class="btn btn-default btn-sm" btn-checkbox ng-model="AppState.menu.layout"
        tooltip="Auto-Layout Settings"
        tooltip-placement="left"
        tooltip-append-to-body="true"
        tooltip-popup-delay="1000"
        >
        <i class="fa fa-wrench"></i>
      </button>
    </div>
    <div collapse="!AppState.menu.layout">
      <label>Charge </label> <input class="form-control" type="number" ng-model="layout.charge" step="10" min="-5000" max="0"></input>
      <label>Gravity </label> <input class="form-control" type="number" ng-model="layout.gravity" min="0" max="1" step="0.1"></input>
      <label>Link Distance </label> <input class="form-control" type="number" ng-model="layout.linkDistance" min="0" max="100" step="1"></input>
      <label>Max Links In </label> <input class="form-control" type="number" ng-model="max.links.in" min="1" max="100" step="1"></input>
      <label>Max Links Out </label> <input class="form-control" type="number" ng-model="max.links.out" min="1" max="100" step="1"></input>
      <label>Zoom </label> <input class="form-control" type="checkbox" ng-model="AppState.zoom"></input>
      <label>Show Modifiers </label> <input class="form-control" type="checkbox" ng-model="linkModifiers"></input>
    </div>
  </div>
</div>
